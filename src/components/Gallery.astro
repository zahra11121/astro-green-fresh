---
/**
 * GALLERY COMPONENT - GOJEK STYLE (Clean Catalog Grid)
 */
import { Leaf, ChevronRight, Image as ImageIcon } from 'lucide-react';
import productsData from '../data/products.json';

const optimizeImage = (url = '', width = 400) => {
  if (!url || typeof url !== 'string') return '';
  if (url.includes('cloudinary.com')) {
    return url.replace('/upload/', `/upload/f_auto,q_auto,w_${width},c_fill,g_auto/`);
  }
  return url;
};

const waLink = `https://wa.me/6287780937884?text=${encodeURIComponent("Halo Green Fresh, saya ingin cek stok komoditas hari ini.")}`;
---

<section class="py-10 md:py-20 bg-white font-sans reveal-container">
  <div class="max-w-[1200px] mx-auto px-4 md:px-10">
    
    <div class="flex items-center justify-between mb-8">
      <div class="space-y-1">
        <h2 class="text-xl md:text-3xl font-black text-[#052c17] tracking-tight uppercase">Katalog Sayur</h2>
        <p class="text-[10px] md:text-sm font-bold text-slate-400 uppercase tracking-widest">Produk Unggulan Hari Ini</p>
      </div>
      <a href={waLink} class="text-[#15803d] text-[11px] md:text-sm font-black uppercase flex items-center gap-1 hover:underline">
        Lihat Semua <ChevronRight size={14} />
      </a>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
      {productsData.map((product, idx) => (
        <div 
          class="group flex flex-col bg-white rounded-2xl border border-slate-100 overflow-hidden hover:shadow-xl transition-all duration-300 reveal-up"
          style={`transition-delay: ${idx * 0.05}s`}
        >
          <div class="relative aspect-square overflow-hidden bg-slate-50">
            <img 
              src={optimizeImage(product.image)}
              alt={product.name}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
              loading="lazy"
            />
            <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-lg border border-slate-100 shadow-sm">
              <span class="text-[8px] font-black text-[#15803d] uppercase tracking-tighter">Grade A</span>
            </div>
          </div>

          <div class="p-3 md:p-5 flex flex-col gap-1">
            <h3 class="text-[13px] md:text-lg font-black text-[#052c17] leading-tight group-hover:text-[#15803d] transition-colors">
              {product.name}
            </h3>
            <div class="flex items-center gap-1.5 opacity-60">
              <Leaf size={10} class="text-[#15803d]" />
              <span class="text-[9px] md:text-[11px] font-bold text-slate-500 uppercase">Cipanas Harvest</span>
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="mt-12 text-center">
      <a 
        href={waLink}
        class="inline-flex items-center gap-3 bg-[#052c17] text-[#bef264] px-8 py-4 rounded-xl text-[11px] font-black uppercase tracking-widest shadow-lg hover:bg-[#15803d] hover:text-white transition-all active:scale-95"
      >
        <ImageIcon size={16} /> Hubungi Sales Specialist
      </a>
    </div>
  </div>
</section>

<style>
  .reveal-container .reveal-up {
    opacity: 0;
    transform: translateY(15px);
    transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
  }

  :global(.is-visible) .reveal-up {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) entry.target.classList.add('is-visible');
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.reveal-up').forEach(el => observer.observe(el));
</script>