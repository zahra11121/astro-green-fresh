---
/**
 * GALLERY COMPONENT - ASTRO VERSION
 * Strategi: Zero Hydration untuk Kecepatan Indeks & SEO Stabil.
 */
import { Camera, Leaf, Image as ImageIcon } from 'lucide-react';
import productsData from '../data/products.json';

/**
 * OPTIMASI IMAGE
 * Dilakukan di sisi server saat build time.
 */
const optimizeImage = (url = '', width = 600) => {
  if (!url || typeof url !== 'string') return '';
  if (url.includes('cloudinary.com')) {
    return url.replace('/upload/', `/upload/f_auto,q_auto,w_${width}/`);
  }
  return url;
};

// WhatsApp Config
const phoneNumber = "6287780937884";
const message = "Halo Green Fresh, saya ingin melihat katalog lengkap komoditas sayur super dan informasi penawaran kerja sama.";
const waLink = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
---

<section class="py-12 lg:py-24 bg-white overflow-hidden font-sans text-left reveal-container">
  <div class="max-w-[1600px] mx-auto px-6 lg:px-12">
    
    <div class="flex flex-col md:flex-row justify-between items-end mb-12 lg:mb-16 gap-6">
      <div class="max-w-2xl text-center md:text-left">
        <div class="flex items-center justify-center md:justify-start gap-2 mb-4 reveal-left">
          <div class="w-8 h-[1px] bg-[#15803d]"></div>
          <span class="text-[10px] font-black uppercase tracking-[0.3em] text-[#15803d]">
            Premium Selection
          </span>
        </div>
        <h2 class="text-4xl md:text-6xl font-serif italic text-[#052c17] leading-[1.1] tracking-tighter uppercase reveal-up">
          Katalog <span class="text-[#15803d] not-italic font-sans">Komoditas Utama.</span>
        </h2>
      </div>
      <p class="text-slate-600 text-sm font-semibold max-w-xs italic md:text-right leading-relaxed border-r-0 md:border-r-2 border-green-200 pr-0 md:pr-6 reveal-right">
        "Menyediakan berbagai varian sayur Grade-A untuk kebutuhan hotel, restoran, dan katering."
      </p>
    </div>

    <div class="columns-2 md:columns-3 lg:columns-4 gap-3 lg:gap-6 space-y-3 lg:space-y-6">
      {productsData.map((product, idx) => (
        <div 
          class="relative break-inside-avoid rounded-2xl lg:rounded-[2rem] overflow-hidden group cursor-pointer shadow-md hover:shadow-2xl transition-all duration-500 bg-slate-50 border border-slate-100 reveal-up"
          style={`transition-delay: ${idx * 0.05}s`}
        >
          <img 
            src={optimizeImage(product.image)}
            alt={`Green Fresh - ${product.name}`}
            class="w-full h-auto object-cover transform group-hover:scale-110 transition-transform duration-700 ease-out"
            loading="lazy"
            decoding="async"
          />
          
          <div class="absolute inset-0 bg-gradient-to-t from-[#052c17] via-[#052c17]/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex flex-col justify-end p-6">
            <div class="translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
               <div class="flex items-center gap-2 mb-2">
                  <Leaf size={14} class="text-[#bef264]" />
                  <span class="text-[10px] font-black text-white uppercase tracking-widest">Grade A Quality</span>
               </div>
               <h3 class="text-white text-xl md:text-2xl font-serif italic font-bold">
                 {product.name}
               </h3>
            </div>
          </div>

          <div class="absolute top-4 right-4 opacity-100 group-hover:opacity-0 transition-opacity">
            <div class="bg-white/80 backdrop-blur-md p-2 rounded-full border border-white/50 shadow-sm">
              <Camera size={14} class="text-[#15803d]" />
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="mt-12 lg:mt-20 text-center reveal-up">
      <a 
        href={waLink}
        target="_blank"
        rel="noopener noreferrer"
        class="bg-[#052c17] hover:bg-[#15803d] text-white px-10 py-5 rounded-full shadow-2xl transition-all text-[11px] font-black uppercase tracking-[0.2em] inline-flex items-center gap-4 group hover:scale-105 active:scale-95"
      >
        <ImageIcon size={18} class="text-[#bef264] group-hover:text-white transition-colors" /> 
        Pesan {productsData.length}+ Komoditas via WhatsApp
      </a>
      <p class="mt-6 text-[10px] uppercase font-black text-slate-400 tracking-widest">
        Freshly Picked • Daily Delivery • Farm to Table
      </p>
    </div>
  </div>
</section>

<style>
  /* Animasi SEO-Friendly tanpa JavaScript Runtime */
  .reveal-container .reveal-up,
  .reveal-container .reveal-left,
  .reveal-container .reveal-right {
    opacity: 0;
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .reveal-up { transform: translateY(20px); }
  .reveal-left { transform: translateX(-20px); }
  .reveal-right { transform: translateX(20px); }

  :global(.is-visible) .reveal-up,
  :global(.is-visible) .reveal-left,
  :global(.is-visible) .reveal-right {
    opacity: 1;
    transform: translate(0);
  }
</style>

<script>
  /**
   * Intersection Observer ringan untuk memicu animasi CSS.
   * Konten tetap terbaca oleh Googlebot karena HTML statis sudah ada di DOM.
   */
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.reveal-container').forEach(el => observer.observe(el));
</script>