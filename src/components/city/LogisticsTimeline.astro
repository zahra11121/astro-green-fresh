---
/**
 * LOGISTICS TIMELINE - GOJEK STYLE (Super-App Minimalist)
 * Fokus: Flat design, compact mobile list, dan tipografi yang efisien.
 */
import { Clock, Truck, CheckCircle2, MapPin, ChevronRight } from 'lucide-react';
import { jabodetabekCities, getDefaultLogistics } from '@/data/cities';

const { slug, cityName } = Astro.props;
const cityData = jabodetabekCities.find(c => c.slug === slug);
const steps = (cityData?.logistics && cityData.logistics.length > 0) 
  ? cityData.logistics 
  : getDefaultLogistics(cityName);
---

<section class="bg-white font-sans reveal-container">
  <div class="px-6 py-6 border-b border-slate-100 flex items-center justify-between">
    <div class="space-y-1">
      <h3 class="text-lg font-black text-[#052c17] tracking-tight uppercase">Jadwal Supply</h3>
      <div class="flex items-center gap-1.5 text-slate-500">
        <MapPin size={12} class="text-[#15803d]" />
        <span class="text-[10px] font-bold uppercase tracking-wider">Cipanas â€” {cityName}</span>
      </div>
    </div>
    <div class="bg-green-50 px-3 py-1.5 rounded-full border border-green-100 flex items-center gap-2">
      <div class="w-1.5 h-1.5 rounded-full bg-[#15803d] animate-pulse"></div>
      <span class="text-[9px] font-black text-[#15803d] uppercase tracking-tighter">Live Fleet</span>
    </div>
  </div>

  <div class="px-6 py-4">
    {steps.map((step, index) => (
      <div class="relative flex gap-5 pb-8 last:pb-2 group reveal-up">
        {index !== steps.length - 1 && (
          <div class="absolute left-[11px] top-8 bottom-0 w-[1.5px] bg-slate-100 group-hover:bg-green-100 transition-colors"></div>
        )}

        <div class="relative z-10 shrink-0 mt-1">
          {index === steps.length - 1 ? (
            <div class="w-[22px] h-[22px] bg-[#15803d] rounded-full flex items-center justify-center shadow-md shadow-green-200">
              <CheckCircle2 size={12} class="text-white" strokeWidth={3} />
            </div>
          ) : (
            <div class="w-[22px] h-[22px] bg-white border-2 border-slate-200 rounded-full flex items-center justify-center group-hover:border-[#15803d] transition-colors">
              <div class="w-1.5 h-1.5 rounded-full bg-slate-200 group-hover:bg-[#15803d]"></div>
            </div>
          )}
        </div>

        <div class="flex-1 pb-4 border-b border-slate-50 group-last:border-none">
          <div class="flex items-center justify-between mb-1">
            <span class="text-[11px] font-black text-[#15803d] bg-green-50 px-2 py-0.5 rounded border border-green-100">
              {step.time}
            </span>
            <ChevronRight size={14} class="text-slate-300 group-hover:text-[#15803d] transition-colors" />
          </div>
          <h4 class="text-[13px] font-black text-[#052c17] uppercase tracking-tight mb-1">
            {step.title}
          </h4>
          <p class="text-[11px] text-slate-500 font-medium leading-relaxed">
            {step.desc}
          </p>
        </div>
      </div>
    ))}
  </div>

  <div class="px-6 py-4 bg-slate-50/50 flex items-center justify-between border-t border-slate-100 opacity-70">
    <div class="flex items-center gap-2">
      <Truck size={12} class="text-slate-400" />
      <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Protocol v.2.1</span>
    </div>
    <div class="flex items-center gap-1.5">
      <Clock size={10} class="text-slate-400" />
      <span class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter italic text-nowrap">Updated: 04:00 AM</span>
    </div>
  </div>
</section>

<style>
  /* Reveal Animations yang lebih halus untuk Mobile */
  .reveal-container .reveal-up {
    opacity: 0;
    transform: translateY(15px);
    transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
  }

  :global(.is-visible) .reveal-up {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const setupTimelineObserver = () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal-up').forEach(el => observer.observe(el));
  };

  setupTimelineObserver();
  document.addEventListener('astro:after-swap', setupTimelineObserver);
</script>