---
// --- SERVER SIDE (Build Time) ---
import MainLayout from '@/layouts/MainLayout.astro';

// Menggunakan Alias @ agar jalur selalu tepat
import { Header } from '@/components/Header';
import { Footer } from '@/components/Footer';
import CityClientPage from '@/components/CityClientPage.jsx';

// Data & Icons
import { jabodetabekCities } from '@/data/cities';
import { galleryData } from '@/data/galleryData';
import { ChevronRight, Home, MapPin } from 'lucide-react';

// 1. Fungsi getStaticPaths (Wajib untuk rute dinamis)
export async function getStaticPaths() {
  return jabodetabekCities.map((city, index) => {
    // Menentukan gambar operasional berdasarkan index agar bervariasi
    const imageIndex = index % galleryData.images.length;
    const CITY_OPERATIONAL_IMAGE = galleryData.images[imageIndex];

    return {
      params: { slug: city.slug },
      props: { 
        city, 
        CITY_OPERATIONAL_IMAGE 
      },
    };
  });
}

const { slug } = Astro.params;
const { city, CITY_OPERATIONAL_IMAGE } = Astro.props;

// Meta & Schema Logic
const title = `Supplier Sayur ${city.name} - CV Green Fresh Cipanas`;
const description = `Layanan supply sayuran grade A harian khusus Hotel, Restoran, dan Cafe di wilayah ${city.name}.`;

// Nearby Cities Logic
const otherCities = jabodetabekCities
  .filter(c => c.slug !== slug)
  .slice(0, 6);
const labelVariations = ["Distribusi", "Supply Sayur", "Pengiriman", "Area Layanan", "Logistik", "Mitra"];
---

<MainLayout title={title} description={description}>
  <div class="bg-white text-[#052c17] font-sans antialiased selection:bg-green-100 overflow-x-hidden text-left">
    <Header client:load />
    
    <main>
      <div class="bg-white pt-24 lg:pt-32 border-b border-green-50">
        <nav aria-label="Breadcrumb" class="max-w-[1800px] mx-auto px-6 py-4 flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em]">
          <a href="/" class="flex items-center gap-1 text-slate-700 hover:text-[#166534] transition-colors">
            <Home size={10} /> Beranda
          </a>
          <ChevronRight size={10} class="text-slate-400" />
          <a href="/city" class="text-slate-700 hover:text-[#166534] transition-colors">
            City
          </a>
          <ChevronRight size={10} class="text-slate-400" />
          <span class="text-[#166534] font-bold tracking-widest">{city.name}</span>
        </nav>
      </div>

      <CityClientPage
        city={city}
        CITY_OPERATIONAL_IMAGE={CITY_OPERATIONAL_IMAGE}
        client:load
      />

      <section class="py-16 bg-white border-t border-green-50">
        <div class="max-w-[1800px] mx-auto px-6">
          <h3 class="text-xs font-black text-[#052c17] mb-8 uppercase tracking-[0.3em] flex items-center gap-3">
            <MapPin size={14} class="text-[#166534]" />
            Cakupan Distribusi Wilayah Lainnya
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            {otherCities.map((otherCity, index) => (
              <a
                href={`/city/${otherCity.slug}`}
                class="group p-5 rounded-2xl border border-green-100 hover:border-[#166534] hover:bg-green-50 transition-all duration-300 flex flex-col items-center justify-center gap-1"
              >
                <span class="text-[9px] font-bold text-slate-600 uppercase tracking-tighter">
                  {labelVariations[index % labelVariations.length]}
                </span>
                <span class="text-[11px] font-[1000] text-slate-900 group-hover:text-[#166534] uppercase tracking-wider block text-center transition-colors">
                  {otherCity.name}
                </span>
              </a>
            ))}
          </div>
        </div>
      </section>
    </main>

    <Footer client:visible />
  </div>
</MainLayout>