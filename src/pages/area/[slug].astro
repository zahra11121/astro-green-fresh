---
// --- SERVER SIDE (Build Time) ---
import MainLayout from '@/layouts/MainLayout.astro';
import { 
  Star, ChevronRight, MapPin 
} from 'lucide-react';

// Components - Menggunakan Alias Path @/
import { Header } from '@/components/Header';
import { Footer } from '@/components/Footer';
import { PartnershipForm } from '@/components/PartnershipForm';
import { PriceTable } from '@/components/PriceTable';
import { vegetableData } from '@/data/data.js'; 
import { DistrictHero } from '@/components/district/DistrictHero';
import { DistrictLogistics } from '@/components/district/DistrictLogistics';
import { DistrictOverview } from '@/components/district/DistrictOverview';
import { DistrictRoute } from '@/components/district/DistrictRoute';
import { QualityGuarantee } from '@/components/city/QualityGuarantee';
import { LiveStats } from '@/components/city/LiveStats';

// Data - Menggunakan Alias Path @/
import districtsData from '@/data/districts.json';

// 1. Fungsi getStaticPaths (Wajib di Astro untuk rute dinamis)
export async function getStaticPaths() {
  return districtsData.districts.map((district) => ({
    params: { slug: district.slug },
    props: { district },
  }));
}

const { slug } = Astro.params;
const { district } = Astro.props;

// Meta & Schema Logic
const baseUrl = 'https://greenfresh.co.id';
const currentUrl = `${baseUrl}/area/${district.slug}`;
const title = `Supplier Sayur ${district.name} - Stok Stabil Harian | CV Green Fresh Cipanas`;
const description = `Supplier sayur segar tangan pertama wilayah ${district.name}. Melayani pengadaan komoditas grade A harian khusus Hotel, Restoran, dan Cafe wilayah ${district.name}.`;

const schemaData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WholesaleStore",
      "@id": `${baseUrl}/#organization`,
      "name": "CV Green Fresh Cipanas",
      "url": baseUrl,
      "logo": {
        "@type": "ImageObject",
        "url": `${baseUrl}/logo.svg`
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Beranda", "item": baseUrl },
        { "@type": "ListItem", "position": 2, "name": "Area", "item": `${baseUrl}/area` },
        { "@type": "ListItem", "position": 3, "name": district.name, "item": currentUrl }
      ]
    }
  ]
};

// Logic for Nearby Areas
const otherAreas = districtsData.districts
  .filter(d => d.slug !== slug)
  .slice(0, 6);
const labels = ["Logistik", "Distribusi", "Supply", "Pengiriman", "Area", "Layanan"];
---

<MainLayout title={title} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(schemaData)} slot="head" />

  <div class="bg-white text-[#052c17] font-sans antialiased overflow-x-hidden selection:bg-green-100 selection:text-green-900">
    <Header client:load />

    <main>
      <div class="pt-24 lg:pt-32 bg-white border-b border-slate-50">
        <nav aria-label="Breadcrumb" class="max-w-[1800px] mx-auto px-6 py-4 flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em]">
          <a href="/" class="text-slate-700 hover:text-[#166534] transition-colors">Beranda</a>
          <ChevronRight size={10} class="text-slate-400" />
          <a href="/area" class="text-slate-700 hover:text-[#166534] transition-colors">Area</a>
          <ChevronRight size={10} class="text-slate-400" />
          <span class="text-[#166534] font-bold tracking-widest uppercase">{district.name}</span>
        </nav>
      </div>

      <DistrictHero district={district} client:load />
      
      <div class="w-full bg-gradient-to-r from-white to-[#f7faf7] py-6 border-y border-green-50/50">
        <div class="max-w-[1800px] mx-auto px-4 md:px-8 flex flex-col md:flex-row items-center justify-between gap-6">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
              <div class="flex -space-x-1">
                {[1, 2, 3, 4, 5].map((s) => (
                  <Star key={s} size={18} class="text-amber-500 fill-amber-500" />
                ))}
              </div>
              <div class="pl-2 border-l border-slate-300">
                <p class="text-2xl font-black text-[#052c17]">4.9</p>
                <p class="text-[10px] font-bold uppercase text-slate-700">Rating Area</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-2 h-2 bg-green-600 rounded-full animate-pulse" />
              <p class="text-sm font-black text-[#052c17] uppercase tracking-tight">Layanan Terverifikasi di {district.name}</p>
            </div>
          </div>
        </div>
      </div>

      <section class="py-16 md:py-24 bg-white">
        <div class="max-w-[1800px] mx-auto px-6">
          <div class="grid lg:grid-cols-12 gap-12 items-start">
            <div class="lg:col-span-6">
              <DistrictOverview district={district} client:visible />
            </div>
            <div class="lg:col-span-6">
              <DistrictLogistics district={district} client:visible />
            </div>
          </div>
        </div>
      </section>

      <section id="katalog" class="py-16 bg-[#f8fafc] border-y border-slate-200">
        <div class="max-w-[1800px] mx-auto px-6">
          <div class="mb-12 text-center md:text-left">
            <h2 class="text-3xl md:text-4xl font-[1000] text-[#052c17] uppercase tracking-tighter">
              Katalog <span class="text-[#15803d]">Komoditas.</span>
            </h2>
            <p class="text-slate-700 text-sm font-black mt-2 uppercase tracking-widest">Update Harga Khusus Area {district.name}</p>
          </div>
          <PriceTable data={vegetableData.slice(0, 20)} client:visible />
        </div>
      </section>

      <QualityGuarantee client:visible />
      <LiveStats client:visible />
      <DistrictRoute district={district} client:visible />
      
      <section class="py-16 bg-white border-t border-slate-100">
        <div class="max-w-[1800px] mx-auto px-4 md:px-8">
          <h3 class="text-xl font-black text-[#052c17] mb-8 uppercase tracking-widest flex items-center gap-2">
            <MapPin size={20} class="text-[#15803d]" /> Area Layanan Terkait
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {otherAreas.map((area, index) => (
              <a
                href={`/area/${area.slug}`}
                class="group p-5 rounded-2xl border border-slate-100 hover:border-[#15803d] hover:bg-green-50 transition-all flex flex-col items-center justify-center gap-1 shadow-sm hover:shadow-md"
              >
                <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">
                  {labels[index % labels.length]}
                </span>
                <span class="text-xs font-black text-slate-800 group-hover:text-[#15803d] uppercase tracking-wider block text-center transition-colors">
                  {area.name}
                </span>
              </a>
            ))}
          </div>
        </div>
      </section>

      <section id="partnership" class="py-20 md:py-32 bg-[#fcfdfc] border-t border-slate-200">
        <div class="max-w-[1800px] mx-auto px-6">
          <div class="text-center mb-16">
            <h2 class="text-3xl md:text-5xl font-[1000] text-[#052c17] uppercase tracking-tighter leading-none">
              Hubungi <span class="text-[#15803d]">Sales.</span>
            </h2>
            <p class="text-slate-700 font-black uppercase text-xs tracking-[0.3em] mt-4">
              Konsultasi Pengadaan Wilayah {district.name}
            </p>
          </div>
          <PartnershipForm client:visible />
        </div>
      </section>
    </main>

    <Footer client:visible />
  </div>
</MainLayout>